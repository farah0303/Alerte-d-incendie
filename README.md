
# üö® Projet Digital Twin ‚Äì Simulation de Capteurs Incendie

## üöÄ Contexte

Dans un monde de plus en plus connect√©, la d√©tection pr√©coce des risques d'incendie devient essentielle, notamment dans les environnements industriels et tertiaires.

Ce projet propose une simulation r√©aliste d‚Äôun syst√®me de capteurs de fum√©e, s‚Äôappuyant sur des technologies modernes telles que **Orion Context Broker**, **MongoDB**, et **Flask**, pour illustrer le concept puissant de **Digital Twin (jumeau num√©rique)**.



## üß† Objectif du Projet

L‚Äôobjectif principal est de mettre en place un syst√®me intelligent capable de simuler et surveiller la pr√©sence de fum√©e dans un environnement s√©curis√©. Voici les fonctionnalit√©s cl√©s :

- üîÅ Simuler un capteur de fum√©e qui g√©n√®re des niveaux de fum√©e entre 0 et 100 % toutes les 10 secondes.
- üö® D√©tecter toute mesure sup√©rieure √† un seuil critique (ex: 50 %) et d√©clencher une alerte imm√©diate via un serveur Flask.
- üßæ Enregistrer toutes les donn√©es dans une base MongoDB, directement depuis Flask.
- üß† G√©rer dynamiquement les entit√©s et les mesures avec Orion Context Broker via l‚ÄôAPI NGSI v2.

Ce projet d√©montre comment un Digital Twin peut √™tre utilis√© pour automatiser, surveiller, alerter et stocker des donn√©es dans un syst√®me distribu√©, typique des architectures IoT industrielles.



## ‚öôÔ∏è Architecture du Syst√®me

### üß© Composants Cl√©s

#### üü¢ Orion Context Broker

- Centralise toutes les entit√©s (capteurs) et leurs donn√©es.
- Permet l‚Äôinteraction via l‚ÄôAPI NGSI pour g√©rer les informations en temps r√©el.

#### üü£ MongoDB

- Sert de base de donn√©es de stockage historique.
- Garde une trace compl√®te de toutes les lectures des capteurs.

#### üî¥ Flask

- Sert √† recevoir des alertes en temps r√©el via une API HTTP POST.
- Affiche les alertes d'incendie dans les logs et peut √™tre √©tendu pour effectuer des actions automatiques (comme envoyer un email ou une notification).
- G√®re √©galement l‚Äôinsertion des donn√©es directement dans MongoDB.




## üåê Pourquoi c‚Äôest important ?

Ce projet est une illustration concr√®te des technologies de l‚ÄôIoT moderne, qui combinent temps r√©el, r√©activit√©, persistance des donn√©es, et supervision intelligente. Il refl√®te :

- Le potentiel des architectures bas√©es sur FIWARE (Orion Context Broker).
- L‚Äôimportance d‚Äôun monitoring intelligent dans les syst√®mes industriels.
- La simplicit√© avec laquelle on peut simuler un Digital Twin efficace √† l‚Äôaide de conteneurs Docker et de technologies comme Flask.



## üì¶ Mod√®les de donn√©es JSON utilis√©s

Le projet utilise plusieurs mod√®les de donn√©es au format **JSON** pour assurer la communication entre les diff√©rents services.

### 1. Donn√©es envoy√©es par le simulateur de capteurs √† Orion

```json
{
  "actionType": "append",
  "entities": [
    {
      "id": "SmokeSensor1",
      "type": "SmokeSensor",
      "smokeLevel": {
        "value": 75.3,
        "type": "Number",
        "metadata": {
          "dateCreated": {
            "type": "DateTime",
            "value": "2025-04-05T12:00:00Z"
          }
        }
      }
    },
    {
      "id": "SmokeSensor2",
      "type": "SmokeSensor",
      "smokeLevel": {
        "value": 68.9,
        "type": "Number",
        "metadata": {
          "dateCreated": {
            "type": "DateTime",
            "value": "2025-04-05T12:00:00Z"
          }
        }
      }
    },
    {
      "id": "SmokeSensor3",
      "type": "SmokeSensor",
      "smokeLevel": {
        "value": 82.1,
        "type": "Number",
        "metadata": {
          "dateCreated": {
            "type": "DateTime",
            "value": "2025-04-05T12:00:00Z"
          }
        }
      }
    }
  ]
}
```

### 2. Alertes envoy√©es √† Flask

```json
{
  "id": "SmokeSensor3",
  "smokeLevel": 82.1
}
```

### 3. Donn√©es stock√©es dans MongoDB

```json
{
  "_id": "ObjectId(...)",
  "id": "SmokeSensor3",
  "type": "SmokeSensor",
  "smokeLevel": 82.1,
  "timestamp": "2025-04-05T12:00:00Z"
}
```

Ces mod√®les assurent une int√©gration coh√©rente entre les services Docker tout en respectant les standards NGSI v2 de FIWARE.


Voici **uniquement la partie explicative du fichier `docker-compose.yml`**, pr√™te √† √™tre ajout√©e dans ton `README.md` ou tout autre document :

---

## üìÅ Fichier `docker-compose.yml`

Le fichier `docker-compose.yml` est utilis√© pour d√©finir et orchestrer les diff√©rents services Docker n√©cessaires √† notre projet de Digital Twin. Il permet de d√©ployer facilement un environnement contenant **Orion Context Broker**, **MongoDB**, une application **Flask** et un simulateur de capteurs, tous interconnect√©s.

### üîß Structure g√©n√©rale

```yaml
version: "3.8"
services:
  orion:
    ...
  mongo-db:
    ...
  flask-app:
    ...
  sensor-simulation:
    ...
networks:
  default:
    ...
volumes:
  mongo-db: ~
```

Ce fichier d√©finit **quatre services principaux** :
- **Orion Context Broker** : gestion des entit√©s (capteurs).
- **MongoDB** : stockage des alertes.
- **Flask App** : serveur web pour recevoir les alertes.
- **Sensor Simulation** : simulation des donn√©es envoy√©es aux capteurs.

Ils sont connect√©s via un r√©seau Docker priv√© avec une configuration IP personnalis√©e.


### üì¶ Services D√©taill√©s

#### 1. **Orion Context Broker**

```yaml
orion:
  labels:
    org.fiware: 'tutorial'
  image: fiware/orion:${ORION_VERSION:-3.3.0}
  hostname: orion
  container_name: fiware-orion
  depends_on:
    - mongo-db
  networks:
      - default
  ports:
    - "${ORION_PORT:-1026}:${ORION_PORT:-1026}"
  command: -dbhost mongo-db -logLevel DEBUG -noCache
  healthcheck:
    test: curl --fail -s http://orion:${ORION_PORT:-1026}/version || exit 1
    interval: 5s
```

- Utilise l‚Äôimage officielle de FIWARE Orion.
- D√©pend de MongoDB (`mongo-db`) comme base de donn√©es.
- Disponible sur le port `1026`.
- Configure Orion pour utiliser MongoDB en mode debug sans cache.
- V√©rifie sa disponibilit√© via `/version`.



#### 2. **MongoDB**

```yaml
mongo-db:
  labels:
    org.fiware: 'tutorial'
  image: mongo:${MONGO_DB_VERSION:-6.0}
  hostname: mongo-db
  container_name: db-mongo
  expose:
    - "${MONGO_DB_PORT:-27017}"
  ports:
    - "${MONGO_DB_PORT:-27017}:${MONGO_DB_PORT:-27017}"
  networks:
    - default
  volumes:
    - mongo-db:/data
  healthcheck:
    test: |
      host=`hostname --ip-address || echo '127.0.0.1'`; 
      mongo --quiet $host/test --eval 'quit(db.runCommand({ ping: 1 }).ok ? 0 : 2)' && echo 0 || echo 1
    interval: 5s
```

- Base de donn√©es utilis√©e par Orion et Flask.
- Stocke les alertes g√©n√©r√©es par le syst√®me.
- Persistance des donn√©es via un volume Docker.
- V√©rifie que la base est op√©rationnelle toutes les 5 secondes.



#### 3. **Flask App**

```yaml
flask-app:
  build: ./flask_app
  container_name: flask-app
  ports:
    - "5000:5000"
  depends_on:
    - orion
  networks:
    - default
  environment:
    - FLASK_ENV=development
  restart: on-failure:5
  healthcheck:
    test: ["CMD", "curl", "-f", "http://localhost:5000/sync"]
    interval: 10s
    timeout: 5s
    retries: 5
```

- Application Flask qui re√ßoit les alertes et synchronise les donn√©es avec Orion.
- Construite depuis le dossier `flask_app`.
- Environnement de d√©veloppement activ√©.
- Red√©marre automatiquement en cas d‚Äô√©chec.
- Teste l‚Äôendpoint `/sync` pour v√©rifier si l‚Äôapplication est pr√™te.



#### 4. **Sensor Simulation**

```yaml
sensor-simulation:
  build: .
  container_name: sensor-simulation
  depends_on:
    - orion
    - flask-app
  networks:
    - default
  environment:
    - ORION_URL=http://orion:1026/v2/op/update
    - FLASK_ALERT_URL=http://flask-app:5000/alert
  restart: always
```

- Simule trois capteurs envoyant des niveaux de fum√©e al√©atoires.
- D√©pend du d√©marrage d‚ÄôOrion et de Flask.
- Variables d‚Äôenvironnement configur√©es pour communiquer avec ces deux services.
- Red√©marre toujours automatiquement.



### üåê R√©seau

```yaml
networks:
  default:
    labels:
      org.fiware: 'tutorial'
    ipam:
      config:
        - subnet: 172.19.0.0/24
```

- Tous les services partagent le m√™me r√©seau Docker.
- Communication entre services via leurs noms (`orion`, `flask-app`, etc.)
- Configuration IP personnalis√©e avec sous-r√©seau `172.19.0.0/24`.



### üíæ Volumes

```yaml
volumes:
  mongo-db: ~
```

- Le volume `mongo-db` permet de persister les donn√©es MongoDB.
- Garantit la sauvegarde des alertes en cas de red√©marrage ou arr√™t du conteneur.



Souhaitez-vous que je vous fournisse cette section au format `.md` ou `.txt` pr√™t √† t√©l√©charger ? üòä

## üß™ Fonctionnement du projet

Le fichier `sensor_simulation.py` joue un r√¥le central dans ce projet, en simulant **trois capteurs de fum√©e virtuels** (`SmokeSensor1`, `SmokeSensor2`, `SmokeSensor3`). Ces capteurs g√©n√®rent automatiquement des niveaux de fum√©e compris entre **0 et 100 %**, repr√©sentant une mesure al√©atoire d‚Äôune situation r√©elle de d√©tection de fum√©e.

### üîÅ D√©roulement du processus :

1. **Initialisation des capteurs :**
   - Le script commence par d√©finir une liste de capteurs avec leurs identifiants uniques et leur type (`SmokeSensor`).
   - Un seuil critique est √©galement configur√© (`SMOKE_LEVEL_THRESHOLD = 80`) pour d√©clencher une alerte en cas de niveau de fum√©e √©lev√©.

2. **G√©n√©ration al√©atoire :**
   - √Ä chaque it√©ration, le script utilise la fonction `generate_smoke_level()` pour produire une valeur al√©atoire entre 0 et 100, simulant la lecture d‚Äôun capteur physique.

3. **Envoi vers Orion Context Broker :**
   - Les donn√©es sont envoy√©es via une requ√™te HTTP POST √† l‚ÄôAPI NGSI d‚ÄôOrion (`http://orion:1026/v2/op/update`), sous forme de payload JSON.
   - Ce payload contient :
     - L‚Äôidentifiant du capteur.
     - La valeur simul√©e du niveau de fum√©e.
     - Une date de cr√©ation au format ISO 8601.

4. **D√©tection d‚Äôanomalie :**
   - Si la valeur g√©n√©r√©e d√©passe le seuil d√©fini, une alerte est imm√©diatement envoy√©e √† Flask via une requ√™te POST sur l‚ÄôURL `http://flask-app:5000/alert`.
   - Cette alerte inclut l‚ÄôID du capteur et le niveau de fum√©e mesur√©.

5. **Boucle infinie :**
   - Le processus se r√©p√®te toutes les **5 secondes**, permettant une surveillance continue des niveaux de fum√©e.

## 4. üõ†Ô∏è Process d'installation de la solution

### ‚úÖ Pr√©requis

- [Docker](https://www.docker.com/get-started/)
- [Docker Compose](https://docs.docker.com/compose/install/)

### üìÅ Structure du projet attendue

```
digital_twin/
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ sensor_simulation.py
‚îú‚îÄ‚îÄ flask_app/
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ app.py
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt
```

### üîß Installation

1. Clonez le d√©p√¥t :
```bash
git clone https://github.com/farah0303/Alerte-d-incendie.git
cd Alerte-d-incendie
```

2. V√©rifiez que tous les fichiers n√©cessaires sont pr√©sents.

3. (Facultatif) Modifiez les variables d‚Äôenvironnement si n√©cessaire.



## 5. ‚ñ∂Ô∏è Comment lancer l'application

Depuis le r√©pertoire racine du projet :

```bash
docker-compose up --build
```

> ‚è±Ô∏è √Ä la premi√®re ex√©cution, Docker t√©l√©charge les images n√©cessaires et construit les conteneurs personnalis√©s (`flask-app` et `sensor-simulation`). Cela peut prendre quelques minutes.


### üß™ V√©rifier que tout fonctionne

Apr√®s quelques secondes, vous pouvez v√©rifier le bon fonctionnement des services en acc√©dant aux points suivants :

- **Orion** : [http://localhost:1026/version](http://localhost:1026/version) ‚Üí devrait afficher la version d‚ÄôOrion (ex: `{"orion": "3.3.0"}`).
- **Flask** : [http://localhost:5000/sync](http://localhost:5000/sync) ‚Üí d√©clenche la synchronisation des donn√©es entre Orion et MongoDB.
- **MongoDB** : `mongodb://localhost:27017` ‚Üí accessible via un outil comme **MongoDB Compass** pour visualiser les alertes enregistr√©es.

üìÅ **De plus, un dossier intitul√© `screenshots` contient des captures d‚Äô√©cran illustrant le bon d√©roulement du projet**, notamment :
- L‚Äôinterface de Flask affichant les alertes,
- Les logs Docker confirmant l‚Äôenvoi des donn√©es √† Orion,
- La base MongoDB avec les alertes stock√©es.

Ces images permettent d‚Äôavoir une vue claire sur le comportement attendu de l‚Äôapplication √† chaque √©tape.

### üîÅ Arr√™ter l‚Äôapplication

```bash
docker-compose down
```
